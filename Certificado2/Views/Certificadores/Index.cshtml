@model IEnumerable<Certificado2.Modelos.Certificadores>

@{
    Layout = "_Layout";
}

<!-- Incluye el enlace a Bootstrap 5.3 desde un CDN -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-...your-integrity-hash..." crossorigin="anonymous">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet" />

<div class="container mt-5" style="padding-top:60px">

    <!-- Botón para agregar certificador -->
    <div class="mb-3">
        <a href="~/Certificadores/Crear" class="btn btn-primary">Agregar Certificador</a>
    </div>

    <!-- Card con el listado de certificadores -->
    <div class="card">
        <div class="card-header">
            <h2>Listado de Certificadores</h2>
        </div>
        <div class="card-body">
            <!-- Formulario de búsqueda -->
            <form action="~/Certificadores/Index" method="get" class="d-flex mb-4">
                <input type="text" class="form-control me-2" placeholder="Certificador" id="Certificador" name="Certificador" value="@ViewBag.Certificador">
                <button type="submit" class="btn btn-outline-primary">
                    Buscar <i class="fa fa-search ms-2"></i>
                </button>
            </form>

            <!-- Tabla de certificadores -->
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Razón Social</th>
                        <th>Nombre Responsable</th>
                        <th>Email</th>
                        <th>Teléfono</th>
                        <th>Logo</th>
                        <th colspan="4">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var certificador in Model)
                    {
                        <tr>
                            <td>@certificador.RazonSocial</td>
                            <td>@certificador.NombreResponsable</td>
                            <td>@certificador.Email</td>
                            <td>@certificador.Telefono</td>
                            <td>
                                @if (certificador.Logo != null)
                                {
                                    string imagen = Convert.ToBase64String(certificador.Logo);
                                    <img src="data:image/jpeg;base64,@imagen" alt="Logo" width="100" class="img-fluid" />
                                }
                                else
                                {
                                    <img src="data:image/jpeg;base64,null" alt="Logo" width="100" class="img-fluid" />
                                }
                            </td>
                            <td>
                                <div class="btn-group-vertical" role="group" aria-label="Acciones">
                                    <a href="~/Certificadores/ObtenerDetalle?id=@certificador.Id" class="btn btn-success btn-sm d-flex align-items-center mb-1">
                                        <i class="fa fa-info-circle me-2"></i> Detalles
                                    </a>
                                    <a href="~/Certificadores/Modificar?id=@certificador.Id" class="btn btn-secondary btn-sm d-flex align-items-center mb-1">
                                        <i class="fa fa-edit me-2"></i> Editar
                                    </a>
                                    <a href="~/Certificadores/ListaUsuarios?Certificador=@certificador.Id" class="btn btn-info btn-sm d-flex align-items-center mb-1">
                                        <i class="fa fa-users me-2"></i> Listado de Usuarios
                                    </a>
                                    @if (!certificador.Suspendido)
                                    {
                                        <a href="javascript:void(0);" onclick="event.preventDefault(); document.getElementById('suspender-form-@certificador.Id').submit();" class="btn btn-danger btn-sm d-flex align-items-center mb-1">
                                            <i class="fa fa-ban me-2"></i> Suspender
                                        </a>
                                        <form id="suspender-form-@certificador.Id" action="~/Certificadores/Suspender" method="post" style="display: none;">
                                            <input type="hidden" name="id" id="id" value="@certificador.Id">
                                        </form>
                                    }
                                    else
                                    {
                                        <a href="javascript:void(0);" onclick="event.preventDefault(); document.getElementById('activar-form-@certificador.Id').submit();" class="btn btn-success btn-sm d-flex align-items-center mb-1">
                                            <i class="fa fa-check-circle me-2"></i> Activar
                                        </a>
                                        <form id="activar-form-@certificador.Id" action="~/Certificadores/Activar" method="post" style="display: none;">
                                            <input type="hidden" name="id" value="@certificador.Id">
                                        </form>
                                    }
                                    <a href="@Url.Action("FoliosDisponibles", "CertificadoresFolios", new { IDCertificador = certificador.Id })" class="btn btn-success btn-sm d-flex align-items-center">
                                        <i class="fa fa-ticket-alt me-2"></i> Folios
                                    </a>
                                </div>
                            </td>



                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Incluye el script de Bootstrap 5.3 desde un CDN -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-...your-integrity-hash..." crossorigin="anonymous"></script>

@* Paginación *@
@if (ViewBag.TotalPages > 1)
{
    <nav id="pagination" aria-label="Page navigation example">
        @if (ViewBag.TotalPages > 1)
        {
            <ul class="pagination justify-content-center">
                @if (ViewBag.CurrentPage > 1)
                {
                    <li class="page-item">
                        <a class="page-link" href="#" data-page="@((int)ViewBag.CurrentPage - 1)">Anterior</a>
                    </li>
                }
                @for (int i = 1; i <= ViewBag.TotalPages; i++)
                {
                    <li class="page-item @(ViewBag.CurrentPage == i ? "active" : "")">
                        <a class="page-link" href="#" data-page="@i">@i</a>
                    </li>
                }
                @if (ViewBag.CurrentPage < ViewBag.TotalPages)
                {
                    <li class="page-item">
                        <a class="page-link" href="#" data-page="@((int)ViewBag.CurrentPage + 1)">Siguiente</a>
                    </li>
                }
            </ul>
        }
    </nav>
}

<script>
    // Manejar clics en los enlaces de paginación
    document.getElementById("pagination").addEventListener("click", function (e) {
        if (e.target.tagName === "A") {
            e.preventDefault();
            var page = parseInt(e.target.getAttribute("data-page"));
            window.location.href = "@Url.Action("Index")" + "?page=" + page;
        }
    });
</script>

